---
layout: default
title: FlsTst_Integration_Manual
nav_order: 5
parent: TMS570 MCU Diag
---
{% raw %}
# Contents [contents]

1 Dependencies 1

1.1 SWCs 2

1.2 Functions to be provided to Integration Project 2

2 Configuration 2

2.1 Build Time Config 2

2.2 Configuration Files to be provided by Integration Project 2

2.2.1 Da Vinci Parameter Configuration Changes 3

2.2.2 DaVinci Interrupt Configuration Changes 3

2.2.3 Manual Configuration Changes 3

3 Integration 4

3.1 Required Global Data Inputs 4

3.2 Optional Global Data Inputs 4

3.3 Specific Include Path present 4

4 Runnable Scheduling 4

5 Memory Mapping 4

5.1 Mapping 4

5.2 Usage 5

5.3 NvM Blocks 5

6 Compiler Settings 5

6.1 Preprocessor MACRO 5

6.2 Optimization Settings 5

7 Revision Control Log 5

# Dependencies

NOTE – the TMS570_uDiag component includes both uDiag and FlsTst
functionality. For complete integration information on the TMS570_uDiag
component, also see the Cd_uDiag integration manual (in the
TMS570_uDiag\doc folder).

## SWCs

<table>
<colgroup>
<col style="width: 36%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="header">
<th>Module</th>
<th>Required Feature</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>NxtrLib</td>
<td><p>DtrmnElapsedTime_uS_u32()</p>
<p>GetSystemTime_uS_u32()</p></td>
</tr>
<tr class="even">
<td>TMS570 CRC peripheral</td>
<td>Exclusive access to the CRC peripheral registers.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>DiagMgr (Nexteer DEM)</td>
<td>NxtrDiagMgr_ReportNTCStatus() API</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Basic System Services</td>
<td>EnableCRCInterrupt()</td>
</tr>
<tr class="even">
<td>DMA</td>
<td><p>DMA register and control packet initialization</p>
<p>Dma_DisableFlsTstBlock()</p>
<p>Dma_SetupFlsTstBlock()</p>
<p>Dma_EnableFlsTstBlock()</p></td>
</tr>
</tbody>
</table>

## Functions to be provided to Integration Project

\< Global function (except the ones that are defined in RTE modules)
that is defined in this component but used by other function\>

void FlsTst_MainFunction( void );

void FlsTst_Init( const FlsTst_ConfigType\* ConfigPtr );

void FlsTst_Suspend( void );

void FlsTst_Resume( void );

# Configuration

## Build Time Config

| Modules | Notes |     |
|---------|-------|-----|
| None    |       |     |

## Configuration Files to be provided by Integration Project

##  [section]

FlsTst_Cfg.c generated by FlsTst_Cfg.c.tt

FlsTst_Cfg.h generated by FlsTst_Cfg.h.tt

NOTES: The FlsTst module parameter description file and generator
templates are located in the “generate” folder. The generation scheme at
this time relies on the ARTT generation framework developed by BMW.
Following are the recommended steps to integrate the provided generation
templates and parameter description with Davinci Configurator:

1.  Copy the “Artt/artt” framework folder into the “Generators”
    directory (if not already present)

2.  Execute the “Integrate.bat” script from the Tools directory of this
    component to perform the necessary integration steps:

    1.  The script creates the required directories in the integration
        project, “Generators/Artt/FlsTst” and
        “Generators/Components/\_Schemes/FlsTst/bswmd”

    2.  The script then copies the required files from the CBD generate
        directory into the new directories.

3.  If this is the first time integration, then perform the Davinci
    Configurator 3rd party component integration procedure.

### Da Vinci Parameter Configuration Changes

| Parameter                                                   | Notes                                                                                                                                                                                                                                                                                                                                                 | SWC                                          |
|-------------------------------|----------------------------|-------------|
| FlsTstConfigSet                                             | At least one block configuration set must be defined. See FlsTst technical reference for details.                                                                                                                                                                                                                                                     | FlsTst                                       |
| FlsTstConfigurationOfOptApiServices                         | Configuration of optional API services. All optional services are disabled by default.                                                                                                                                                                                                                                                                | FlsTst                                       |
| FlsTstDemEventParameterRefs                                 | Configuration of NTC enumeration symbol name for diagnostic tests performed in this module.                                                                                                                                                                                                                                                           | FlsTst                                       |
| FlsTstGeneral                                               | General module configuration. See FlsTst technical reference for details.                                                                                                                                                                                                                                                                             | FlsTst                                       |
| FlsTst\Runtime\FlsTstBlockBgndConfigSet\App\FlsTstBlockSize | Number of bytes in flash test block – NOTE that this number has a max value of 8388600 in the current version of the uDiag component, and a max value of 524280 in version FDD32B_TMS570_uDiag_000.21 and previous. Numbers greater than the max value will not give an error indication but will cause the flash CRC check to not operate correctly. | FlsTst (contained in TMS570_uDiag component) |

### DaVinci Interrupt Configuration Changes

| ISR Name      | VIM \# | Priority Dependency | Notes                      |
|---------------|--------|---------------------|----------------------------|
| FlsTst_CrcIRQ | 19     |                     | Must be IRQ and Category 2 |
|               |        |                     |                            |

### Manual Configuration Changes

| Constant | Notes | SWC |
|----------|-------|-----|
| None     |       |     |

# Integration

## Required Global Data Inputs

\<Mention any global variable that this component requires for other
components\>

## Optional Global Data Inputs

\<Mention any global variable that this component requires for other
components\>

## Specific Include Path present

\<Yes\>

# Runnable Scheduling

This section specifies the required runnable scheduling.

<table>
<colgroup>
<col style="width: 27%" />
<col style="width: 49%" />
<col style="width: 12%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr class="header">
<th>Runnable</th>
<th>Scheduling Requirements</th>
<th>Privileged Mode</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FlsTst_Init()</td>
<td><p>Must be executed prior to using FlsTst_MainFunction()</p>
<p>Must be executed after Dma_Init</p></td>
<td>Required</td>
<td>Init*</td>
</tr>
<tr class="even">
<td>FlsTst_MainFunction()</td>
<td>Scheduling cycle can influence the time to complete the background
test interval. A new test block is started only during the invocation of
the MainFunction, so an excessively large period between MainFunction
calls will extend the time for a test interval to complete.</td>
<td></td>
<td>Cyclic</td>
</tr>
<tr class="odd">
<td>FlsTst_CrcIrq()</td>
<td>Scheduled via hardware IRQ. The integrator must enable the interrupt
source configured in the Os before this runnable can be triggered by the
hardware.</td>
<td></td>
<td>IRQ on signature failure</td>
</tr>
</tbody>
</table>

\* Can be called during run time to change block test configuration if
required.

# Memory Mapping

## Mapping

| Constant                                 | Notes |
|------------------------------------------|-------|
| FLSTST_START_SEC_VAR_CLEARED_8           |       |
| FLSTST_START_SEC_VAR_16                  |       |
| FLSTST_START_SEC_VAR_CLEARED_UNSPECIFIED |       |
| FLSTST_START_SEC_VAR_UNSPECIFIED         |       |
| FLSTST_START_SEC_CODE                    |       |
| FLSTST_START_SEC_CONST_UNSPECIFIED       |       |

\* Each …START_SEC… constant is terminated by a …STOP_SEC… constant as
specified in the AUTOSAR Memory Mapping requirements.

## Usage

| Feature     | RAM | ROM |
|-------------|-----|-----|
| Full driver |     |     |

Table 1: ARM Cortex R4 Memory Usage

## NvM Blocks

| Block Name         |
|--------------------|
| \<NvM Block Info\> |

Note : Size of the NVM block if configured in developer

# Compiler Settings

##  Preprocessor MACRO

\<Define all the preprocessor Macros needed and conditions when
needed\>.

## Optimization Settings

##  [section-1]

# Revision Control Log

|            |                                                                           |           |                     |
|------|-----------------------------------------------|---------|----------|
| **Rev \#** | **Change Description**                                                    | **Date**  | **Author Initials** |
| 1          | Initial version                                                           |           | JJW                 |
| 2          | Updated integration process description to reference use of Integrate.bat | 09/18/12  | JJW                 |
| 3          | Updated to latest template, other misc cleanup.                           | 06-Jan-14 | KMC                 |
| 4          | Modified for changes to use with new DMA component.                       | 07-Apr-14 | KMC                 |

{% endraw %}